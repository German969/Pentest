<?php 
session_start();

include 'pg.inc.php';

//Si se ha rellenado anteriormente el formulario, comprobar los datos
if(isset($_POST["nombre"])){

	//Sentencias SQL a ejecutar
	$sql = "select * from usuarios where nombre = '".$_POST['nombre']."' and contrasena = '".$_POST['pwd']."'";
	
	$resultado = ejecutar_SQL($conexion,$sql);

	//Si hay filas, los datos de acceso eran correctos
	if(numero_filas($resultado) != 0){
		//Obtener los datos del usuario logueado
		$fila = fila($resultado, 0);

		//Almacenar su ID en los datos de la sesion
		$_SESSION["usuario"] = $fila["id"];

		//Dar la bienvenida
		echo "<h3>Login OK</h3>
		Bienvenid@, ".$fila["descripcion"]."<br>
		Pulse <a href='producto.php'>aqu&iacute;</a> para continuar. <br/>";
	
	} else {
		echo "<h3>Login fallido</h3>";
	}


};

//Si no se ha iniciado la sesion, mostrar un formulario de logon
if(!isset($_SESSION["usuario"])){
	print '<form method="POST" action="login.php">
			<table border="1">
				<tr><td colspan="2">Introduzca sus datos de acceso</td></tr>
				<tr><td>Nombre:&nbsp;</td><td><input type="text" name="nombre" id="nombre"></td></tr>
				<tr><td>Clave:&nbsp;</td><td><input type="password" name="pwd" id="pwd"></td></tr>
			</table>
			<input type="submit" value="Enviar">
		</form>' ;
};

 ?>
