R3(config)# crypto isakmp enable

R3(config)# crypto isakmp policy 10
R3(config-isakmp)# hash sha
R3(config-isakmp)# authentication pre-share
R3(config-isakmp)# group 14
R3(config-isakmp)# lifetime 3600
R3(config-isakmp)# encryption aes 256
R3(config-isakmp)# end

R3(config)# crypto isakmp key cisco123 address 10.1.1.1

R3(config)# crypto ipsec transform-set 50 esp-aes 256 esp-sha-hmac
R3(cfg-crypto-trans)# exit

R3(config)# crypto ipsec security-association lifetime seconds 1800

R3(config)# access-list 101 permit ip 192.168.3.0 0.0.0.255 192.168.1.0 0.0.0.255

R3(config)# crypto map CMAP 10 ipsec-isakmp
R3(config-crypto-map)# match address 101
R3(config-crypto-map)# set peer 10.1.1.1
R3(config-crypto-map)# set pfs group14
R3(config-crypto-map)# set transform-set 50
R3(config-crypto-map)# set security-association lifetime seconds 900
R3(config-crypto-map)# exit

R3(config)# interface S0/0/1
R3(config-if)# crypto map CMAP
*Jan 28 04:10:54.138: %CRYPTO-6-ISAKMP_ON_OFF: ISAKMP is ON 
R3(config)# end

----------------------------------------------------

conf t

ip route 0.0.0.0 0.0.0.0 20.0.0.1

crypto isakmp enable

crypto isakmp policy 10
hash sha
authentication pre-share
group 1
lifetime 3600
encryption aes 256
exit

crypto isakmp key cisco123 address 10.0.0.2

crypto ipsec transform-set 50 esp-aes 256 esp-sha-hmac
exit

crypto ipsec security-association lifetime seconds 1800

access-list 101 permit ip 172.16.0.0 0.0.0.255 192.168.1.0 0.0.0.255

crypto map CMAP 10 ipsec-isakmp
match address 101
set peer 10.0.0.2
set pfs group1
set transform-set 50
set security-association lifetime seconds 900
exit

interface f0/1
crypto map CMAP
end

----------------------------

conf t

ip route 0.0.0.0 0.0.0.0 10.0.0.1

crypto isakmp enable

crypto isakmp policy 10
hash sha
authentication pre-share
group 1
lifetime 3600
encryption aes 256
exit

crypto isakmp key cisco123 address 20.0.0.2

crypto ipsec transform-set 50 esp-aes 256 esp-sha-hmac
exit

crypto ipsec security-association lifetime seconds 1800

access-list 101 permit ip 192.168.1.0 0.0.0.255 172.16.0.0 0.0.0.255

crypto map CMAP 10 ipsec-isakmp
match address 101
set peer 20.0.0.2
set pfs group1
set transform-set 50
set security-association lifetime seconds 900
exit

interface f0/0
crypto map CMAP
end


----------------------------
R3# show crypto map

R3# show crypto isakmp sa

R3# show crypto ipsec sa

----------------------------

TIK

https://wiki.mikrotik.com/wiki/Manual:IP/IPsec


/interface bridge
add name=bridge1
/ip ipsec policy group
add name=group1
/ip ipsec proposal
add enc-algorithms=aes-256-cbc,aes-256-ctr,aes-256-gcm name=proposal1 pfs-group=modp768
/ip pool
add name=dhcp ranges=192.168.1.3-192.168.1.254
/ip dhcp-server
add address-pool=dhcp disabled=no interface=bridge1 name=dhcp1
/interface bridge port
add bridge=bridge1 interface=ether2
/interface l2tp-server server
set caller-id-type=ip-address
/ip address
add address=10.0.0.2/24 interface=ether1 network=10.0.0.0
add address=192.168.1.1/24 interface=ether2 network=192.168.1.0
/ip dhcp-client
add dhcp-options=hostname,clientid interface=ether1
/ip dhcp-server network
add address=192.168.1.0/24 gateway=192.168.1.1 netmask=24
/ip ipsec peer
add address=20.0.0.2/32 dh-group=modp1024,modp768 enc-algorithm=aes-256,aes-128,3des secret=cisco123
/ip ipsec policy
add dst-address=20.0.0.2/32 proposal=proposal1 sa-dst-address=20.0.0.2 sa-src-address=10.0.0.2 src-address=10.0.0.2/32 tunnel=yes
/ip route
add distance=1 gateway=10.0.0.1


